<form id="collapseInputForm" [formGroup]="entryForm">
  <div class="card" style="padding: 0;">

    <div class="card-header">
      <div *ngIf="!productAdded">
        Select Product
      </div>

      <div *ngIf="productAdded">
        Selected Product:  <strong>{{storeInProductViewModel.productName}}</strong>
      </div>

    </div>
    <div class="card-body" style="height: 250px">
      <div class="row" style="padding: 0">

        <div class="col-sm-3" style="padding-left: 0">
          <div class="form-group required">
            <div class="col-sm-12">
              <label for="store" class="required-label lb-sm">Store:</label>
              <ng-select [items]="storeModelList"
                         #storeDropDown
                         id="store"
                         bindLabel="name"
                         bindValue="id"
                         (change)="onChangeStore($event, storeInProductViewModel.storeId)"
                         (clear)="onClearStore()"
                         [(ngModel)]="storeInProductViewModel.storeId"
                         [ngClass]="{ 'custom-invalid-ng-select': productAdded && entryForm.controls['store']?.hasError('required')}"
                         formControlName="store"
                         placeholder="Select Store">
              </ng-select>
              <div *ngIf="productAdded && entryForm.controls['store'].hasError('required')"
                   class="custom-invalid-feedback">
                Select a Store
              </div>
            </div>
          </div>
        </div>

        <div class="col-sm-3" style="padding-left: 0">
          <div class="form-group required">
            <div class="col-sm-12">
              <label for="vendor" class="required-label lb-sm">Vendor:</label>
              <ng-select [items]="vendorModelList"
                         id="vendor"
                         bindLabel="name"
                         bindValue="id"
                         (clear)="onClearVendor()"
                         (change)="onChangeVendor($event)"
                         [(ngModel)]="storeInProductViewModel.vendorId"
                         [ngClass]="{ 'custom-invalid-ng-select': productAdded && entryForm.controls['vendor']?.hasError('required') }"
                         formControlName="vendor"
                         placeholder="Select Vendor">
              </ng-select>
              <div *ngIf="productAdded && entryForm.controls['vendor'].hasError('required')"
                   class="custom-invalid-feedback">
                Select a Vendor
              </div>
            </div>
          </div>
        </div>

        <div class="col-sm-2" style="padding-left: 0">
          <div class="form-group">
            <label class="lb-sm">Product Menu:</label>

            <div class="row">

             <!-- <input type="text"
                     [attr.disabled]="isDisableBarcodeInput()?'':null"
                     class="form-control">-->
              <div class="col-sm-10 " style="padding-right: 0% ">
              <ng-select [items]="productModelList"
                         id="productList"
                         bindLabel="modelNo"
                         bindValue="id"
                         groupBy="name"
                         [ngClass]="{ 'avoid-clicks': isDisableBarcodeInput() }"
                         (change)="onChangeProduct($event)"
                         [ngModel]="selectedProductIdFromDropDownMenu"
                         formControlName="productList"
                         placeholder="Select Product">
              </ng-select>
              </div>
              <div class="col-sm-1" style="padding-left: 0%">

              <button [attr.disabled]="isDisableBarcodeInput()?'':null"
                        class="btn btn-outline-secondary"
                        (click)="productListModal.open()"
                        type="button">...</button>

              </div>
            </div>

          </div>
        </div>

        <div class="col-sm-2" style="padding-left: 0">
          <div class="form-group">
            <div class="col-sm-12">
              <label for="barcode" class="lb-sm">Product barcode:</label>

              <input class="form-control"
                     #barcode
                     type="text"
                     id="barcode"
                     [attr.disabled]="isDisableBarcodeInput()?'':null"
                     (change)="onChangeBarcode(storeInProductViewModel.barcode,$event)"
                     (focus)="onFocusBarcode()"
                     formControlName="barcode"
                     autocomplete="off"
                     name="barcode"
                     [(ngModel)]="storeInProductViewModel.barcode">
              <span *ngIf="entryForm.controls['barcode'].hasError('maxlength') " class="custom-invalid-feedback">
                Maximum character for barcode is 20
              </span>
            </div>
          </div>
        </div>

        <div class="col-sm-2" style="padding-left: 0">
          <div class="form-group required">
            <label for="entryDate" class="required-label lb-sm">Entry Date</label>
            <div class="input-group datepicker-input">
              <input type="text"
                     name="entryDate"
                     id="entryDate"
                     [ngClass]="{ 'is-invalid': productAdded && entryForm.controls['entryDate']?.hasError('required')}"
                     #entryDMY="bsDatepicker"
                     [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY' }"
                     placeholder="Select a date"
                     formControlName="entryDate"
                     [(ngModel)]="storeInProductViewModel.entryDate"
                     class="form-control"
                     bsDatepicker>
              <button class="input-group-addon" (click)="entryDMY.toggle()" type="button">
                <span class="fa fa-calendar"></span>
              </button>
              <div *ngIf="productAdded && entryForm.controls['entryDate'].hasError('required')"
                   class="custom-invalid-feedback">
                Select Entry Date
              </div>
            </div>
          </div>
        </div>

        <!--

        <div class="col-sm-2" style="padding-left: 0">
          <div class="form-group">
            <div class="col-sm-12">
              <label for="price" class="lb-sm">Price</label>

              <input class="form-control"
                     type="text"
                     id="price"
                     name="price"
                     autocomplete="off"
                     onkeypress="return (event.charCode > 31) && (event.charCode >= 48 && event.charCode <= 57)"
                     [(ngModel)]="storeInProductViewModel.price"
                     formControlName="price"
                     placeholder="">
              <span *ngIf="entryForm.controls['price'].hasError('max') " class="custom-invalid-feedback">
                Maximum value can be entered 1000000000
              </span>
            </div>
          </div>
        </div>

        <div class="col-sm-2" style="padding-left: 0">
          <div class="form-group">
            <div class="col-sm-12">
              <label for="quantity" class="lb-sm">Quantity</label>

              <input class="form-control"
                     type="text"
                     id="quantity"
                     maxlength="3"
                     name="quantity"
                     pattern="^[1-9]\d*$"
                     (focusout)="onFocusOutQuantityEvent()"
                     autocomplete="off"
                     onkeypress="return (event.charCode > 31) && (event.charCode >= 48 && event.charCode <= 57)"
                     formControlName="quantity"
                     [(ngModel)]="storeInProductViewModel.quantity"
                     placeholder="">
              <span *ngIf="entryForm.controls['quantity'].hasError('max') " class="custom-invalid-feedback">
                Maximum Quantity enterated at a time is 100
              </span>
            </div>
          </div>
        </div>

        <div class="col-sm-2" style="padding-left: 0">
          <div class="form-group">
            <div class="col-sm-12">
              <label for="total" class="lb-sm">Total</label>

              <input class="form-control"
                     type="text"
                     id="total"
                     name="total"
                     disabled
                     [ngModel]="storeInProductViewModel.totalPrice"
                     formControlName="total"
                     placeholder="Total Price">
            </div>
          </div>
        </div>

        -->

      </div>
      <div class="row" style="padding: 0; margin: 0">
        <!--


        <div class="col-sm-2" style="padding-left: 0">
          <div class="form-group required">
            <label for="mfDate" class="lb-sm">Manufacturing Date</label>
            <div class="input-group datepicker-input">
              <input type="text"
                     name="mfDate"
                     id="mfDate"
                     #mfDMY="bsDatepicker"
                     [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY' }"
                     placeholder="Select a date"
                     [ngClass]="{ 'is-invalid': productAdded && entryForm.controls['mfDate'].hasError('required') }"
                     formControlName="mfDate"
                     [(ngModel)]="storeInProductViewModel.manufacturingDate"
                     class="form-control"
                     bsDatepicker>
              <button class="input-group-addon" (click)="mfDMY.toggle()" type="button">
                <span class="fa fa-calendar"></span>
              </button>
            </div>
            <div *ngIf="productAdded && entryForm.controls['mfDate'].hasError('required')"
                 class="custom-invalid-feedback">
              Select Manufacturing Date
            </div>
          </div>
        </div>

        -->


       <!--

        <div class="col-sm-2" style="padding-left: 0">
          <div class="form-group required">
            <label for="expDate" class="lb-sm">Expiry Date</label>
            <div class="input-group datepicker-input">
              <input type="text"
                     name="expDate"
                     id="expDate"
                     [ngClass]="{ 'is-invalid': productAdded && entryForm.controls['expDate']?.hasError('required') }"
                     #expDMY="bsDatepicker"
                     [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY' }"
                     placeholder="Select a date"
                     formControlName="expDate"
                     [(ngModel)]="storeInProductViewModel.expirationDate"
                     class="form-control"
                     bsDatepicker>
              <button class="input-group-addon" (click)="expDMY.toggle()" type="button">
                <span class="fa fa-calendar"></span>
              </button>
              <div *ngIf="productAdded && entryForm.controls['expDate'].hasError('required')"
                   class="custom-invalid-feedback">
                Select Expiry Date
              </div>
            </div>
          </div>
        </div>

        -->



        <!--  <div class="col-sm-6" style="padding-left: 0">
            <div class="form-group required">

            </div>
          </div>-->


      </div>
    </div>

    <div class="card-footer">
    <!--  <button type="button"

              name="clearAll"
              id="btnAddProduct"
              (click)="onClickAddProduct()"
              class="btn btn-outline-success btn-sm pull-right">Add Product
      </button>
-->
      <button type="button"
              name="btnClear"
              style="margin-right: 1%"
              id="btnClear"
              (click)="onClickClear()"
              class="btn btn-outline-danger btn-sm pull-right">Clear
      </button>
    </div>

  </div>

</form>




<div class="card" style="margin-top: 1%; z-index: auto" [hidden]="storeInProductViewModelList.length==0">

    <form #dynamicForm="ngForm" novalidate autocomplete="off">

        <div class="card-header">
          <strong> Added products</strong>
        </div>

        <div class="custom-scroll-y">
          <div class="card-body">


          <table class="table table-hover table-bordered table-sm table-striped">
            <thead>
            <tr>
              <th style="width: 2%">SL No</th>
              <th style="width: 14%">Product</th>
              <th style="width: 8%">Model No</th>
              <th style="width: 10%">SerialNo</th>
              <th style="width: 8%">price</th>
              <th style="width: 2%">Quantity</th>
              <th style="width: 10%">Total</th>

            <!--  <th style="width: 12%">Entry Date</th>-->
              <th style="width: 4%">Action</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let storeInProductViewModel of storeInProductViewModelList; let i=index">
              <td>{{i+1}}</td>
              <td><strong>{{storeInProductViewModel.productName}}</strong></td>
              <td>{{storeInProductViewModel.modelNo}}</td>
              <td>
                <input #dynamicSerialNo="ngModel"
                       class="form-control form-control-sm"
                       maxlength="50"
                       type="text"
                       id="dynamicSerialNo{{i}}"
                       name="dynamicSerialNo{{i}}"
                       [(ngModel)]="storeInProductViewModel.serialNo">
              </td>
              <td>
                <input class="form-control form-control-sm"
                       type="text"
                       maxlength="8"
                       pattern="^(\d*\.)?\d+$"
                       (focusout)="onFocusOutPriceRowEvent(i)"
                       onkeypress="return (event.charCode > 31) && (event.charCode >= 48 && event.charCode <= 57)
                       || event.charCode==46"
                       #dynamicPrice="ngModel"
                       required
                       autocomplete="off"
                       [ngClass]="{ 'is-invalid': dynamicPrice.errors?.pattern}"
                       id="dynamicPrice{{i}}"
                       name="dynamicPrice{{i}}"
                       [(ngModel)]="storeInProductViewModel.price">

              </td>
              <td>
                <input class="form-control form-control-sm"
                       #dynamicQuantity="ngModel"
                       name="quantity"
                       type="text"
                       maxlength="3"
                       pattern="^[1-9]\d*$"
                       autocomplete="off"
                       required
                       [ngClass]="{ 'is-invalid': dynamicQuantity.errors?.pattern}"
                       onkeypress="return (event.charCode > 31) && (event.charCode >= 48 && event.charCode <= 57)"
                       (focusout)="onFocusOutQuantityRowEvent(i)"
                       id="dynamicQuantity{{i}}"
                       name="dynamicQuantity{{i}}"
                       [(ngModel)]="storeInProductViewModel.quantity">
              </td>
              <td>{{storeInProductViewModel.totalPrice}}</td>
              <td class="align-baseline">

                <div class="row" style="margin-right: 0px;">
                  <div class="col-sm-4">
                    <button
                      placement="top"
                      class="btn btn-sm btn-pill btn-outline-info"
                      type="button">
                      <i class="fa fa-pencil-square"></i>
                    </button>
                  </div>
                  <div class="col-sm-6">
                    <button
                      placement="top"
                      (click)="onClickRemoveRow(i)"
                      class="btn btn-sm btn-pill btn-outline-info"
                      type="button">
                      <i class="fa fa-minus-square"></i>
                    </button>
                  </div>
                </div>
              </td>
            </tr>
            </tbody>
            <tbody *ngIf="grandTotalStockInPrice!=0">
              <tr>
                <td colspan="4"></td>
                <td colspan="2">Grand Total</td>
                <td colspan="1">{{grandTotalStockInPrice}}</td>
              </tr>
            </tbody>
          </table>
        </div>
        </div>

    </form>

    <div class="card-footer">

      <button type="button"

              name="saveBtn"
              id="saveBtn"
              (click)="onClickSave(dynamicForm)"
              class="btn btn-outline-success btn-sm pull-right">Save
      </button>

      <button type="button"
              style="margin-right: 1%"
              name="clearAll"
              id="clearAll"
              (click)="onClickClearAllAddedProduct()"
              class="btn btn-outline-danger btn-sm pull-right">Clear All
      </button>

    </div>

</div>

<ngx-smart-modal #productListModal [closable]="false"
                 identifier="productListModal"
                 [dismissable]="false"
                 customClass="nsm-dialog-animation-fade nsm-centered">
  <h4>Select products</h4>
  <p>
    <product-list (selectedProductList)="onClickSelectedProductOfModal($event)"></product-list>
  </p>


  <div *ngIf="productListModal.hasData()">
    <pre>{{ productListModal.getData() | json }}</pre>
  </div>
  <button class="button -dark"
          (click)="productListModal.close()">Close</button>
</ngx-smart-modal>

<save-confirmation-modal
  [header]="modalHeader"
  [body]="modalBodyText"
  (isConfirm)="onClickSaveConfirmationOfModal($event)">
</save-confirmation-modal>





